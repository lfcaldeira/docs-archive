<!DOCTYPE html><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Installing and using Windows modules</title>
<link rel="stylesheet" type="text/css" href="https://puppet-docs-herrera.netlify.app/css/fonts.css">
<link rel="stylesheet" type="text/css" href="https://puppet-docs-herrera.netlify.app/css/docs.css">
<meta name="prodname" content="pe">
<meta name="version" content="2016.4">
</head>
<body><div class="pm-site-secondary">
  <div class="container pm-site-secondary__wrapper">

    <section>
      <div class="pm-site-secondary__satellite">
        <nav>
          <div class="pm-site-secondary__satellite-menu"><ul class="pm-site-secondary__satellite-menu__items items">
<li class="item"><a href="/">Puppet.com</a></li>
<li class="item"><a href="https://forge.puppet.com/">Forge</a></li>
<li class="item"><a href="https://learn.puppet.com/">Compass</a></li>
<li><div class="button-wrapper">
                                <a href="/try-puppet/" class="pm-button pm-button--purple">
                                    Try Puppet
                                </a><!-- This URL might change -->
                              </div></li>
</ul></div>
<!-- Content generated with JS -->
        </nav>
      </div>
    </section>

  </div>
</div>
<header id="pm-site-header" class="pm-site-header">
  <div class="container pm-site-header__wrapper">
    <section>
      <div class="pm-site-header__primary">
        <div class="pm-site-header__logo">
          <a href="/" class="pm-link">
            <svg width="124" height="52" viewbox="0 0 124 52" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g>
                <path d="M50.1614 50.451H56.2668V18.8085H50.1614V30.4919C49.1846 29.3236 47.0355 28.2039 44.691 28.2039C38.3414 28.2039 34.7759 33.3641 34.7759 39.5952C34.7759 45.8264 38.3414 50.9379 44.691 50.9379C47.0355 50.9379 49.1846 49.8182 50.1614 48.6499V50.451ZM50.1614 43.1489C49.4776 44.658 47.8658 45.6803 46.0586 45.6803C42.7861 45.6803 40.8324 43.0516 40.8324 39.5952C40.8324 36.0902 42.7861 33.4614 46.0586 33.4614C47.817 33.4614 49.4776 34.5324 50.1614 35.9928V43.1489Z" fill="#222629"></path>
                <path d="M79.88 39.5952C79.88 32.8773 75.533 28.2039 69.1834 28.2039C62.8338 28.2039 58.4868 32.8773 58.4868 39.5952C58.4868 46.2645 62.8338 50.9379 69.1834 50.9379C75.533 50.9379 79.88 46.2645 79.88 39.5952ZM73.8723 39.5952C73.8723 43.1976 72.2117 45.8264 69.1834 45.8264C66.1552 45.8264 64.4945 43.1976 64.4945 39.5952C64.4945 35.9442 66.1552 33.3154 69.1834 33.3154C72.2117 33.3154 73.8723 35.9442 73.8723 39.5952Z" fill="#222629"></path>
                <path d="M82.1001 39.5952C82.1001 46.3132 86.3983 50.9379 92.6013 50.9379C98.0717 50.9379 101.54 47.7736 102.175 43.1003H96.2157C95.8738 44.7554 94.555 45.7777 92.6013 45.7777C89.8173 45.7777 88.1078 43.2463 88.1078 39.5952C88.1078 35.8955 89.8173 33.3641 92.6013 33.3641C94.555 33.3641 95.8738 34.3864 96.2157 36.0415H102.175C101.54 31.4169 98.0717 28.2039 92.6013 28.2039C86.3983 28.2039 82.1001 32.8286 82.1001 39.5952Z" fill="#222629"></path>
                <path d="M104.395 43.9765C105.029 48.4065 108.79 50.9379 114.115 50.9379C119.194 50.9379 123.053 48.3091 123.053 43.8791C123.053 40.5689 121.05 38.4756 117.241 37.5506L112.747 36.5283C111.38 36.1876 110.793 35.7008 110.793 34.8245C110.793 33.4614 112.21 32.7799 113.675 32.7799C115.678 32.7799 116.703 33.7049 117.094 34.9219H122.858C122.125 30.8327 119.097 28.2039 113.577 28.2039C108.693 28.2039 104.883 31.0274 104.883 35.2626C104.883 38.9137 107.227 40.6175 110.549 41.3964L114.945 42.37C116.459 42.7595 117.143 43.2463 117.143 44.2199C117.143 45.6317 115.922 46.3619 114.066 46.3619C112.259 46.3619 110.891 45.5343 110.402 43.9765H104.395Z" fill="#222629"></path>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M4.44027 39.8298H8.88053V35.4043H4.44027V39.8298ZM4.44027 8.85106H8.88053V4.42553H4.44027V8.85106ZM28.8617 28.766V15.4894H18.8711L13.3208 9.95745V0H0V13.2766H9.9906L15.5409 18.8085V25.4468L9.9906 30.9787H0V44.2553H13.3208V34.2979L18.8711 28.766H28.8617Z" fill="#FFAE1A"></path>
              </g>
            </svg>
          </a>
        </div>

        <nav class="pm-site-header__primary-nav">
          <button title="Show or hide navigation" class="pm-site-header__primary-menu__hamburger" id="pm-site-header__primary-menu__hamburger">
            <span class="pm-site-header__primary-menu__hamburger__frame">
              <span class="pm-site-header__primary-menu__hamburger__inner"></span>
            </span>
          </button>

          <div class="pm-site-header__primary-menu">
<nav class="pm-site-header__primary-menu__nav ">
                    <button class="pm-link pm-link--unstyled pm-button--empty">
        Docs
        <span class="item-chevron">
          <svg width="14" height="9" viewbox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M7.00016 4.9763L10.8217 1.15481C11.4725 0.503938 12.5278 0.503938 13.1787 1.15481C13.8295 1.80569 13.8295 2.86096 13.1787 3.51183L8.17867 8.51183C7.5278 9.16271 6.47252 9.16271 5.82165 8.51183L0.821651 3.51183C0.170778 2.86096 0.170778 1.80569 0.821651 1.15481C1.47253 0.503938 2.5278 0.503938 3.17867 1.15481L7.00016 4.9763Z" fill="#ffaeia"></path>
            </svg>
        </span>
      </button>
                    <ul class="pm-site-header__primary-menu__nav-dropdown">
<li class="heading">Products</li>
<li class="link"><a href="/docs/pe/latest">Puppet Enterprise</a></li>
<li class="link"><a href="/docs/puppet/latest/">Open Source Puppet</a></li>
<li class="link"><a href="/docs/bolt/latest/">Bolt</a></li>
<li class="link"><a href="/docs/pdk/latest/">Puppet Development Kit</a></li>
<li class="link"><a href="/docs/puppetdb/latest/">Puppet DB</a></li>
<li class="link"><a href="/docs/remediate/latest/">Puppet Remediate</a></li>
<li class="link"><a href="/docs/vro/">Puppet Plugin for VMware</a></li>
</ul>
                </nav><nav class="pm-site-header__primary-menu__nav ">
                    <button class="pm-link pm-link--unstyled pm-button--empty">
        Support
        <span class="item-chevron">
          <svg width="14" height="9" viewbox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M7.00016 4.9763L10.8217 1.15481C11.4725 0.503938 12.5278 0.503938 13.1787 1.15481C13.8295 1.80569 13.8295 2.86096 13.1787 3.51183L8.17867 8.51183C7.5278 9.16271 6.47252 9.16271 5.82165 8.51183L0.821651 3.51183C0.170778 2.86096 0.170778 1.80569 0.821651 1.15481C1.47253 0.503938 2.5278 0.503938 3.17867 1.15481L7.00016 4.9763Z" fill="#ffaeia"></path>
            </svg>
        </span>
      </button>
                    <ul class="pm-site-header__primary-menu__nav-dropdown">
<li class="heading">Get</li>
<li class="link"><a href="/pe/latest">Technical Support Plans</a></li>
<li class="link"><a href="/puppet/latest/">Support Lifecycle Policy</a></li>
<li class="link"><a href="/bolt/latest/">New Puppet Enterprise Customer?</a></li>
</ul>
                </nav><nav class="pm-site-header__primary-menu__nav is-last-nav-child">
                    <button class="pm-link pm-link--unstyled pm-button--empty">
        Community
        <span class="item-chevron">
          <svg width="14" height="9" viewbox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M7.00016 4.9763L10.8217 1.15481C11.4725 0.503938 12.5278 0.503938 13.1787 1.15481C13.8295 1.80569 13.8295 2.86096 13.1787 3.51183L8.17867 8.51183C7.5278 9.16271 6.47252 9.16271 5.82165 8.51183L0.821651 3.51183C0.170778 2.86096 0.170778 1.80569 0.821651 1.15481C1.47253 0.503938 2.5278 0.503938 3.17867 1.15481L7.00016 4.9763Z" fill="#ffaeia"></path>
            </svg>
        </span>
      </button>
                    <ul class="pm-site-header__primary-menu__nav-dropdown">
<li class="heading">About Puppet</li>
<li class="link"><a href="/pe/latest">TBD...</a></li>
<li class="link"><a href="/puppet/latest/">TBD...</a></li>
<li class="heading">Community</li>
<li class="link"><a href="/pe/latest">Puppet Champions</a></li>
<li class="link"><a href="/puppet/latest/">Puppet Test Pilots</a></li>
<li class="link"><a href="/puppet/latest/">Community Office Hours</a></li>
<li class="link"><a href="/puppet/latest/">Slack Channel</a></li>
</ul>
                </nav><button id="pm-site-header__primary-menu__search" class="pm-site-header__primary-menu__search pm-link--unstyled pm-button--empty">
            <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="pm-site-header__primary-menu__search-icon">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M0 10.5C0 16.4257 4.73529 21 10.5 21C16.2647 21 21 16.4257 21 10.5C21 4.78218 16.2647 0 10.5 0C4.73529 0 0 4.78218 0 10.5ZM3 10.5C3 14.7327 6.38235 18 10.5 18C14.6176 18 18 14.7327 18 10.5C18 6.41584 14.6176 3 10.5 3C6.38235 3 3 6.41584 3 10.5Z" fill="#222629"></path>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M16.409 16.409C17.2877 15.5303 18.7123 15.5303 19.591 16.409L23.341 20.159C24.2197 21.0377 24.2197 22.4623 23.341 23.341C22.4623 24.2197 21.0377 24.2197 20.159 23.341L16.409 19.591C15.5303 18.7123 15.5303 17.2877 16.409 16.409Z" fill="#222629"></path>
            </svg>
          </button>
</div> <!-- Content generated with JS -->

        </nav>
      </div>
<!-- End pm-site-header__primary -->
    </section>

    <div class="pm-site-header__divider"></div>

  </div>
<!-- End pm-site-header__wrapper -->
</header><!-- End pm-site-header -->
<div class="container docs-search-inpage">
  <div class="pm-search-wrapper">
    <div class="pm-input">
      <!-- Search Form -->
      <div id="pm-search-box" class="pm-search-box"></div>
      <!-- /Search Form -->
    </div>
    <div class="pm-grid pm-grid--has-gutter" id="pm-search-content">
      <div class="pm-column pm-column--base-span-12 pm-pagination-wrapper">
        <!-- Pagination -->
        <div id="pm-pagination"></div>
        <!-- /Pagination -->
      </div>
      <div class="pm-column pm-column--base-span-12 pm-column--above-sm-span-6 pm-hits-wrapper">
        <!-- Search Results -->
        <ul id="pm-hits"></ul>
        <!-- /Search Results -->
      </div>
      <div class="pm-column pm-column--base-span-12 pm-column--above-sm-span-4 pm-refinement-product-wrapper">
        <!-- Product Refinement List -->
        <div id="pm-product" data-title="Product"></div>
        <!-- /Product Refinement List -->
      </div>
      <div class="pm-column pm-column--base-span-12 pm-column--above-sm-span-2 pm-refinement-version-wrapper">
        <!-- Version Refinement List -->
        <div id="pm-version" data-title="Version"></div>
        <!-- /Refinement List -->
      </div>
    </div>
  </div>
</div>
<div class="container" id="content"><div class="row">
<nav role="toc" class="pm-product-version-select__nav">
	<div class="pm-product-version-select"> <h4 class="pm-product-version-select__header">PRODUCT AND VERSION</h4>
  <div class="pm-product-version-select__type">
    <button id="product-type-select-button" class="pm-product-version-select__type-select-button pm-link pm-link--unstyled pm-button--empty">
      Current product
      <svg width="14" height="9" viewbox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg" class="chevron">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.00016 4.9763L10.8217 1.15481C11.4725 0.503938 12.5278 0.503938 13.1787 1.15481C13.8295 1.80569 13.8295 2.86096 13.1787 3.51183L8.17867 8.51183C7.5278 9.16271 6.47252 9.16271 5.82165 8.51183L0.821651 3.51183C0.170778 2.86096 0.170778 1.80569 0.821651 1.15481C1.47253 0.503938 2.5278 0.503938 3.17867 1.15481L7.00016 4.9763Z"></path>
      </svg>
    </button>

    <ul class="pm-product-version-select__type-options"></ul>
<!-- Content Generated by JS -->
  </div>
<!-- End pm-product-version-select -->

  <!-- Version Select -->
  <div class="pm-product-version-select__version">
    <button id="product-version-select-button" class="pm-product-version-select__version-select-button pm-link pm-link--unstyled pm-button--empty">
      Current version
      <svg width="14" height="9" viewbox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg" class="chevron">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M7.00016 4.9763L10.8217 1.15481C11.4725 0.503938 12.5278 0.503938 13.1787 1.15481C13.8295 1.80569 13.8295 2.86096 13.1787 3.51183L8.17867 8.51183C7.5278 9.16271 6.47252 9.16271 5.82165 8.51183L0.821651 3.51183C0.170778 2.86096 0.170778 1.80569 0.821651 1.15481C1.47253 0.503938 2.5278 0.503938 3.17867 1.15481L7.00016 4.9763Z"></path>
      </svg>
    </button>

    <ul class="pm-product-version-select__version-options"></ul>
<!-- Content Generated by JS -->
  </div>
</div>



  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./overview_about_pe.html">Welcome to PE</a></li>
      <li><a href="./pe_architecture_overview.html">PE architecture overview</a></li>
      <li><a href="./overview_version_table.html">Component versions in recent PE releases</a></li>
      <li><a href="./overview_getting_support.html">Getting support</a></li>
      <li><a href="./pe_versioning.html">PE version numbers</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./release_notes.html">New features and enhancements</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./release_notes_known_issues_install.html">Install and upgrade</a></li>
          <li><a href="./release_notes_known_issues_console.html">PE console and console services</a></li>
          <li><a href="./release_notes_known_issues_puppetserver.html">Puppet Server</a></li>
          <li><a href="./release_notes_known_issues_puppetdb.html">Databases and PostgreSQL</a></li>
          <li><a href="./release_notes_known_issues_app.html">Orchestration services</a></li>
          <li><a href="./release_notes_known_issues_core.html">PE services and Puppet core</a></li>
          <li><a href="./release_notes_known_issues_platforms.html">Supported platforms</a></li>
          <li><a href="./release_notes_known_issues_razor.html">Razor</a></li>
          <li><a href="./release_notes_known_issues_codemgmt.html">Code management</a></li>
          <li><a href="./release_notes_known_issues_utf8.html">UTF-8</a></li>
        </ul>
      </li>
      <li><a href="./release_notes_resolved_issues.html">Resolved issues</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li><a href="./puppet_overview.html">Puppet platform documentation</a></li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li class="has-children">
        <ul>
          <li><a href="./quick_start_install_mono.html">1: Install PE</a></li>
          <li><a href="./quick_start_install_agents_nix.html">2: Install agents</a></li>
          <li><a href="./quick_start_module_install_nix.html">3: Module install</a></li>
          <li><a href="./quick_start_adding_class_nix.html">4: Add classes</a></li>
          <li><a href="./quick_start_nc_rbac.html">5: Give users access</a></li>
          <li><a href="./quick_writing_nix.html">6: Write modules</a></li>
        </ul>
      </li>
      <li class="has-children">
        <ul>
          <li><a href="./quick_start_install_mono.html">1: Install PE</a></li>
          <li><a href="./quick_start_install_agents_windows.html">2: Install agents</a></li>
          <li><a href="./quick_start_module_install_windows.html">3: Module install</a></li>
          <li><a href="./quick_start_adding_class_windows.html">4: Classify agents</a></li>
          <li><a href="./quick_start_rbac_windows.html">5: Assign user access</a></li>
          <li><a href="./quick_writing_windows.html">6: Write modules</a></li>
        </ul>
      </li>
      <li class="has-children">
        <ul>
          <li><a href="./quick_start_ntp.html">NTP quick start guide</a></li>
          <li><a href="./quick_start_dns.html">DNS quick start guide</a></li>
          <li><a href="./quick_start_ssh.html">SSH quick start guide</a></li>
          <li><a href="./quick_start_sudo.html">Sudo quick start guide</a></li>
          <li><a href="./quick_start_firewall.html">Firewall quick start guide</a></li>
        </ul>
      </li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item active"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./windows_installing.html">Installing PE for a Windows environment</a></li>
      <li><a href="./windows_basic_tasks.html">Basic tasks and concepts in Windows</a></li>
      <li><a href="./windows_config_mgmnt.html">Managing Windows configurations</a></li>
      <li class="active"><a href="./windows_modules.html">Installing and using Windows modules</a></li>
      <li><a href="./troubleshooting_windows.html">Troubleshooting Puppet on Windows</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li class="has-children">
        <ul>
          <li><a href="./sys_req_hw.html">Hardware requirements</a></li>
          <li><a href="./sys_req_os.html">Supported operating systems</a></li>
          <li><a href="./sys_req_browsers.html">Supported browsers</a></li>
          <li><a href="./sys_req_sysconfig.html">System config and firewall requirements</a></li>
        </ul>
      </li>
      <li><a href="./install_what_and_where.html">What gets installed where?</a></li>
      <li><a href="./install_basic.html">Downloading PE and installing overview</a></li>
      <li><a href="./install_pe_mono.html">Web-based installation: monolithic</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./install_text_mode.html">Text-mode installation overview</a></li>
          <li><a href="./install_text_mode_mono.html">Text-mode installation: monolithic</a></li>
          <li><a href="./install_text_mode_split.html">Text-mode installation: split</a></li>
          <li><a href="./install_pe_conf_param.html">Configuration settings in pe.conf</a></li>
        </ul>
      </li>
      <li><a href="./install_license_key.html">Installing PE license key</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./install_agents.html">Installing agents: *nix</a></li>
          <li><a href="./install_windows.html">Installing agents: Windows</a></li>
          <li><a href="./install_osx.html">Installing agents: Mac OS X</a></li>
        </ul>
      </li>
      <li class="has-children">
        <ul>
          <li><a href="./install_eos.html">Installing agents: Arista EOS</a></li>
          <li><a href="./install_nxos.html">Installing agents: Cisco NS-OX</a></li>
          <li><a href="./install_iosxr.html">Installing agents: Cisco IOS-XR</a></li>
          <li><a href="./install_cumulus.html">Installing agents: Cumulus Linux</a></li>
        </ul>
      </li>
      <li><a href="./install_multimaster.html">Installing compile masters</a></li>
      <li><a href="./install_lei_load.html">Load balancing compile masters</a></li>
      <li><a href="./install_add_activemq.html">Installing ActiveMQ hubs and spokes</a></li>
      <li><a href="./install_pe_client_tools.html">Installing PE client tools</a></li>
      <li><a href="./install_uninstalling.html">Uninstalling PE</a></li>
      <li><a href="./install_separate_pe_postgres.html">Installing standalone PE-PostgreSQL</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./sys_req_extsql.html">External PostgreSQL prep</a></li>
          <li><a href="./install_ssl_postgresql.html">SSL for PE and external PostgreSQL</a></li>
          <li><a href="./install_external_postgresql.html">PE and external PostgreSQL without root access</a></li>
        </ul>
      </li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./upgrade_mono.html">Upgrading PE: monolithic</a></li>
      <li><a href="./upgrade_split.html">Upgrading PE: split</a></li>
      <li><a href="./install_upgrading_agents.html">Upgrading PE agents: *nix</a></li>
      <li><a href="./upgrade_windows.html">Upgrading PE agents: Windows</a></li>
      <li><a href="./install_lei_upgrade.html">Upgrading large environment installations</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./migrate_pe_catalog_preview.html">Preparing for Migration to PE 2016.4</a></li>
      <li><a href="./migrate_monolithic.html">Migrating from PE 3.8 to 2016.4: monolithic</a></li>
      <li><a href="./migrate_notes.html">Migrating: important notes</a></li>
      <li><a href="./install_upgrading_path_changes.html">Major path changes</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./config_intro.html">Your PE infrastructure</a></li>
      <li><a href="./config_puppetserver.html">Tuning Puppet Server</a></li>
      <li><a href="./puppet_server_config_files.html">Puppet Server config files</a></li>
      <li><a href="./console_config.html">Tuning the console</a></li>
      <li><a href="./config_puppetdb.html">Tuning PuppetDB</a></li>
      <li><a href="./config_orchestration.html">Tuning orchestration</a></li>
      <li><a href="./config_java_args.html">Java arguments For PE</a></li>
      <li><a href="./config_ulimit.html">Configuring ulimit for PE services</a></li>
      <li><a href="./config_monolithic.html">Tuning mono installs (reference)</a></li>
      <li><a href="./config_hocon.html">Writing configuration files</a></li>
      <li><a href="./analytics_opt_out.html">Opt out of Puppet data collection</a></li>
      <li><a href="./static_catalogs.html">Static catalogs</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./CM_overview.html">Monitor and analyze infrastructure state</a></li>
      <li><a href="./CM_graph.html">Explore your catalog with the node graph</a></li>
      <li><a href="./CM_events.html">Analyze changes across Puppet runs</a></li>
      <li><a href="./CM_reports.html">Infrastructure reports</a></li>
      <li><a href="./puppet_server_metrics.html">Monitoring Puppet Server metrics</a></li>
      <li><a href="./status_api.html">Monitoring PE services</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./console_cert_mgmt.html">Managing node requests</a></li>
      <li><a href="./console_classes_groups_running_puppet.html">Running Puppet on agent nodes</a></li>
      <li><a href="./console_classes_groups_getting_started.html">Getting started with classification</a></li>
      <li><a href="./console_classes_groups.html">Grouping and classifying nodes</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./r_n_p_intro.html">Introduction</a></li>
          <li><a href="./r_n_p_full_example.html">A complete example</a></li>
          <li><a href="./r_n_p_profiles.html">Designing advanced profiles</a></li>
          <li><a href="./r_n_p_roles.html">Designing convenient roles</a></li>
        </ul>
      </li>
      <li><a href="./nodes_viewing.html">Viewing node-specific information</a></li>
      <li><a href="./console_classes_groups_making_changes.html">Making changes to node groups</a></li>
      <li><a href="./node_deactivation.html">Removing nodes</a></li>
      <li><a href="./console_classes_groups_preconfigured_groups.html">Preconfigured node groups</a></li>
      <li><a href="./console_classes_groups_inheritance.html">How does inheritance work?</a></li>
      <li><a href="./console_classes_groups_environment_override.html">Working with environments</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./nc_index.html">Endpoints</a></li>
          <li><a href="./nc_forming_requests.html">Forming node classifier requests</a></li>
          <li class="has-children">
            <ul>
              <li><a href="./nc_groups_example.html">Groups endpoint examples</a></li>
            </ul>
          </li>
          <li><a href="./nc_classes.html">Classes</a></li>
          <li><a href="./nc_classification.html">Classification</a></li>
          <li><a href="./nc_commands.html">Commands</a></li>
          <li><a href="./nc_environments.html">Environments</a></li>
          <li><a href="./nc_nodes.html">Node history</a></li>
          <li><a href="./nc_groups_children.html">Group children</a></li>
          <li><a href="./nc_rules.html">Rules</a></li>
          <li><a href="./nc_import-hierarchy.html">Importing node classifier hierarchy</a></li>
          <li><a href="./nc_last_class_update.html">Last class</a></li>
          <li><a href="./nc_update_classes.html">Updating node classifier classes</a></li>
          <li><a href="./nc_validate.html">Validating node classifier endpoints</a></li>
          <li><a href="./nc_errors.html">Node classifier errors</a></li>
        </ul>
      </li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./console_accessing.html">Accessing the console</a></li>
      <li><a href="./rbac_intro.html">Role-based access control</a></li>
      <li><a href="./rbac_ldap.html">Connecting PE with external directory services</a></li>
      <li><a href="./rbac_permissions.html">About RBAC permissions</a></li>
      <li><a href="./rbac_user_roles.html">Creating and managing users and user roles</a></li>
      <li><a href="./rbac_token_auth.html">Token-based authentication</a></li>
      <li><a href="./deploy_nonroot-agent.html">Running agents without root privileges</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./rbac_serviceindex_v1.html">Endpoints</a></li>
          <li><a href="./rbac_forming_requests_v1.html">Forming RBAC requests</a></li>
          <li><a href="./rbac_users_v1.html">Users</a></li>
          <li><a href="./rbac_usergroups_v1.html">User groups</a></li>
          <li><a href="./rbac_roles_v1.html">Roles</a></li>
          <li><a href="./rbac_permissionsref_v1.html">Permissions</a></li>
          <li><a href="./rbac_token_v1.html">Authentication tokens</a></li>
          <li><a href="./rbac_dsref_v1.html">Directory service</a></li>
          <li><a href="./rbac_passwords_v1.html">Passwords</a></li>
          <li><a href="./rbac_serviceerrors_v1.html">Errors</a></li>
          <li><a href="./rbac_config_v1.html">Configuration options</a></li>
        </ul>
      </li>
      <li class="has-children">
        <ul>
          <li><a href="./rbac_serviceindex_v2.html">Endpoints</a></li>
          <li><a href="./rbac_revoke_token_v2.html">Revoke tokens</a></li>
        </ul>
      </li>
      <li class="has-children">
        <ul>
          <li><a href="./rbac_activityapis.html">Endpoints</a></li>
          <li><a href="./rbac_activityreporting.html">Activity reporting</a></li>
        </ul>
      </li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./app_orchestration_overview.html">Application orchestration: Overview</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./app_orchestration_workflow.html">Application orchestration workflow</a></li>
          <li><a href="./app_orchestration_app_definition.html">Creating application definitions</a></li>
          <li><a href="./app_orchestration_declare_instance.html">Declaring application instances</a></li>
          <li><a href="./app_orchestration_produce_consume.html">Producing and consuming service resources</a></li>
          <li><a href="./app_orchestration_writing_service_resources.html">Writing custom service resource types</a></li>
          <li><a href="./app_orchestration_availability_tests.html">Availability tests</a></li>
        </ul>
      </li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./direct_puppet_workflow.html">Direct Puppet: a workflow</a></li>
      <li><a href="./orchestrator_intro.html">Puppet orchestrator: overview</a></li>
      <li><a href="./orchestrator_install.html">Configuring Puppet orchestrator</a></li>
      <li><a href="./orchestrator_app.html">Reviewing applications</a></li>
      <li><a href="./orchestrator_job_plan.html">Checking a Puppet job plan</a></li>
      <li><a href="./orchestrator_job_run.html">Running Puppet jobs</a></li>
      <li><a href="./orchestrator_job_status_view.html">Reviewing Puppet jobs</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./orchestrator_api_endpoints.html">Endpoints</a></li>
          <li><a href="./orchestrator_api_requests.html">Forming requests</a></li>
          <li><a href="./orchestrator_api_commands.html">Commands</a></li>
          <li><a href="./orchestrator_api_events.html">Events</a></li>
          <li><a href="./orchestrator_api_jobs.html">Jobs</a></li>
          <li><a href="./orchestrator_api_root.html">Root</a></li>
          <li><a href="./orchestrator_api_errors.html">Errors</a></li>
        </ul>
      </li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./cmgmt_managing_code.html">Managing and deploying Puppet code</a></li>
      <li><a href="./cmgmt_control_repo.html">Setting up a control repository</a></li>
      <li><a href="./cmgmt_puppetfile.html">Managing environment content with Puppetfiles</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./code_mgr.html">Managing code with Code Manager</a></li>
          <li><a href="./code_mgr_config.html">Configuring Code Manager</a></li>
          <li><a href="./code_mgr_custom.html">Customizing Code Manager configuration</a></li>
          <li><a href="./code_mgr_cli.html">Triggering Code Manager from the command line</a></li>
          <li><a href="./code_mgr_webhook.html">Triggering Code Manager with a webhook</a></li>
          <li><a href="./code_mgr_scripts.html">Triggering Code Manager with custom scripts</a></li>
          <li><a href="./code_mgr_troubleshoot.html">Troubleshooting Code Manager</a></li>
        </ul>
      </li>
      <li class="has-children">
        <ul>
          <li><a href="./r10k.html">Managing code with r10k</a></li>
          <li><a href="./r10k_config.html">Configuring r10k</a></li>
          <li><a href="./r10k_custom.html">Customizing r10k configuration</a></li>
          <li><a href="./r10k_run.html">Deploying environments with r10k</a></li>
          <li><a href="./r10k_reference.html">r10k subcommand reference</a></li>
        </ul>
      </li>
      <li><a href="./cmgmt_filesync.html">About file sync</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./razor_intro.html">Bare-metal provisioning with Razor</a></li>
      <li><a href="./razor_prereqs.html">Setting up a Razor environment</a></li>
      <li><a href="./razor_install.html">Installing Razor</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./razor_client_commands.html">Razor client commands</a></li>
        </ul>
      </li>
      <li><a href="./razor_brownfield.html">Protecting existing nodes</a></li>
      <li><a href="./razor_using.html">Provisioning a node</a></li>
      <li><a href="./razor_windows_install.html">Provisioning a Windows node</a></li>
      <li><a href="./razor_microkernel_extension.html">Provisioning with custom facts</a></li>
      <li class="has-children">
        <ul>
          <li><a href="./razor_repos.html">Repositories</a></li>
          <li><a href="./razor_tasks.html">Tasks</a></li>
          <li><a href="./razor_tags.html">Tags</a></li>
          <li><a href="./razor_policies.html">Policies</a></li>
          <li><a href="./razor_brokers.html">Brokers</a></li>
          <li><a href="./razor_hooks.html">Hooks</a></li>
        </ul>
      </li>
      <li class="has-children">
        <ul>
          <li><a href="./razor_reference.html">API reference</a></li>
        </ul>
      </li>
      <li><a href="./razor_upgrade.html">Upgrading Razor</a></li>
      <li><a href="./razor_uninstall.html">Uninstalling Razor</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li class="has-children">
        <ul>
          <li><a href="./trouble_regenerate_certs_monolithic.html">Regenerating certs: mono</a></li>
          <li><a href="./trouble_regenerate_certs_split.html">Regenerating certs: splits</a></li>
        </ul>
      </li>
      <li class="has-children">
        <ul>
          <li><a href="./regenerate_certs_master.html">Regenerating certs for the Puppet master</a></li>
          <li><a href="./regenerate_certs_puppetdb.html">Regenerating certs for PuppetDB</a></li>
          <li><a href="./regenerate_certs_console.html">Regenerating certs for the PE console</a></li>
        </ul>
      </li>
      <li><a href="./agent_cert_regen.html">Regenerating a Puppet agent certificate</a></li>
      <li><a href="./compile_master_cert_regen.html">Regenerating a compile master certificate</a></li>
      <li><a href="./external_ca.html">Using an external certificate authority with PE</a></li>
      <li><a href="./custom_console_cert.html">Configuring the PE console to use a custom SSL certificate</a></li>
      <li><a href="./trouble_dh_generate.html">Custom Diffie-Hellman param file generation</a></li>
      <li><a href="./install_ssl_postgresql.html">SSL for PE and external PostgreSQL</a></li>
      <li><a href="./disable_tlsv1.html">Disable TLSV1 in PE</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./api_index.html">Index of Puppet APIs</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./mco_overview.html">Overview</a></li>
      <li><a href="./mco_invoke_cli.html">Invoking actions</a></li>
      <li><a href="./orchestration_puppet.html">Controlling Puppet</a></li>
      <li><a href="./mco_actions.html">List of built-in actions</a></li>
      <li><a href="./mco_adding_actions.html">Adding new actions</a></li>
      <li><a href="./mco_config.html">Configuring MCollective</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./maintain_console-db.html">PE database maintenance</a></li>
      <li><a href="./maintain_backup_restore.html">Back up and restore PE</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./trouble_install.html">Troubleshooting the installer</a></li>
      <li><a href="./trouble_comms.html">Troubleshooting connections</a></li>
      <li><a href="./code_mgr_troubleshoot.html">Troubleshooting Code Manager</a></li>
      <li><a href="./trouble_console-db.html">Troubleshooting the databases</a></li>
      <li><a href="./trouble_puppet.html">Troubleshooting Puppet core</a></li>
      <li><a href="./trouble_orchestration.html">Troubleshooting MCollective</a></li>
      <li><a href="./trouble_windows.html">Troubleshooting Windows</a></li>
    </ul>
  </li></ul>
  <ul class="pm-product-menu-item"><li>
    <ul class="pm-product-menu-item__children">
      <li><a href="./compliance_alt.html">Compliance alternate workflow</a></li>
    </ul>
  </li></ul>




</nav><main role="main" class="col-lg-9"><article role="article"><h1>Installing and using Windows modules</h1>
<h2 id="windows-module-pack">Windows module pack</h2>
<p>The Puppet Forge is an online community of Puppet modules submitted by Puppet and community members. The Forge makes it easier for you to manage Puppet and can save you time by using pre-written modules, rather than writing your own. In addition to being rated by the community, modules in the Forge can be <a href="https://forge.puppetlabs.com/approved">Puppet Approved</a> or <a href="https://forge.puppetlabs.com/supported">Puppet Supported</a>. The major difference is that Approved modules are not available for <a href="https://puppetlabs.com/services/customer-support">Puppet Enterprise support services</a>, but are still tested and adhere to a standard for style and quality.</p>
<p><img src="images/windows/puppetlabs_windows_modulepack.png" alt="Windows Module Pack"></p>
<p>The Windows module pack includes several Windows compatible modules that help you complete common specific tasks. You can find more Windows modules by searching the Forge. Only the modules by Puppet are supported with Puppet Enterprise. The rest have been reviewed and recommended by Puppet but are not eligible for commercial support.</p>
<p>The Windows module pack enables the following:</p>
<ul>
  <li>Read, create, and write registry keys with <a href="https://forge.puppetlabs.com/puppetlabs/registry"><code>registry</code></a>.</li>
  <li>Interact with PowerShell through the Puppet DSL with <a href="https://forge.puppetlabs.com/puppetlabs/powershell"><code>powershell</code></a>.</li>
  <li>Manage Windows PowerShell DSC (Desired State Configuration) resources using <a href="https://forge.puppetlabs.com/puppetlabs/dsc"><code>dsc</code></a>.</li>
  <li>Reboot Windows as part of management as necessary through <a href="https://forge.puppetlabs.com/puppetlabs/reboot"><code>reboot</code></a>.</li>
  <li>Enforce fine-grained access control permissions using <a href="https://forge.puppetlabs.com/puppetlabs/acl"><code>acl</code></a>.</li>
  <li>Manage Windows Server Update Service configs on client nodes <a href="https://forge.puppetlabs.com/puppetlabs/wsus_client"><code>wsus_client</code></a>.</li>
  <li>Install or remove Windows features with <a href="https://forge.puppetlabs.com/puppet/windowsfeature"><code>windowsfeature</code></a>.</li>
  <li>Download files for use during management via <a href="https://forge.puppetlabs.com/puppet/download_file"><code>download_file</code></a>.</li>
  <li>Build IIS sites and virtual applications with <a href="https://forge.puppetlabs.com/puppet/iis"><code>iis</code></a>.</li>
  <li>Install packages with <a href="https://forge.puppetlabs.com/chocolatey/chocolatey"><code>chocolatey</code></a>.</li>
  <li>Manage environment variables with <a href="https://forge.puppetlabs.com/badgerious/windows_env"><code>windows_env</code></a>.</li>
</ul>
<p>This guide covers creating a managed permission with <code>ACL</code>, creating managed registry keys and values with <code>registry</code>, and installing and creating your own packages with <code>chocolatey</code>.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>Before you install and begin working with the Windows pack of modules, you should have <a href="./install_windows.html">installed Puppet Enterprise</a>.</p>
<h2 id="install-the-windows-module-pack">Install the Windows module pack</h2>
<p>These steps show you how to install the module pack locally, but you can also install it on the Puppet master and pluginsync will push the module pack to all of your nodes.</p>
<ol>
  <li>
    <p>On your Windows <strong>Start</strong> page, click <strong>Start Command Prompt with Puppet</strong>.</p>

    <p><img src="images/windows/start_commandprompt.png" alt="Start command prompt with Puppet"></p>
  </li>
  <li>
    <p>To list modules that you currently have installed, type <code>puppet module list</code> in your <strong>Command Prompt</strong> window. If you’re just getting started, you likely have no modules installed yet.</p>

    <p><img src="images/windows/cli_list_empty_modules.png" alt="puppet module list empty output"></p>
  </li>
  <li>
    <p>Next, to install the <code>puppetlabs/windows</code> module pack, type <code>puppet module install puppetlabs/windows</code>. Notice that you get a nice output of everything that’s installed.</p>

    <pre><code class="language-puppet">C:\&gt;puppet module install puppetlabs/windows
Notice: Preparing to install into
C:/ProgramData/PuppetLabs/code/environments/production/modules ...
Notice: Downloading from https://forgeapi.puppetlabs.com ...
Notice: Installing -- do not interrupt ...
C:/ProgramData/PuppetLabs/code/environments/production/modules
└─┬ puppetlabs-windows (v2.1.0)
├─┬ chocolatey-chocolatey (v1.2.0)
│ └── badgerious-windows_env (v2.2.2)
├── puppet-download_file (v1.2.1)
├── puppet-iis (v1.4.1)
├── puppet-windowsfeature (v1.1.0)
├── puppetlabs-acl (v1.1.1)
├── puppetlabs-powershell (v1.0.5)
├── puppetlabs-reboot (v1.2.0)
├─┬ puppetlabs-registry (v1.1.2)
│ └── puppetlabs-stdlib (v4.9.0)
└── puppetlabs-wsus_client (v1.0.0)
</code></pre>
  </li>
</ol>
<h2 id="task-1-manage-permissions-with-acl">Task 1: Manage permissions with <code>acl</code>
</h2>
<p><img src="images/windows/forge_acl.png" alt="Forge puppetlabs-acl"></p>
<p>The <a href="https://forge.puppetlabs.com/puppetlabs/acl"><code>puppetlabs-acl</code></a> module helps you manage access control lists (ACLs), which provide a way to interact with permissions for the Windows file system. This module enables you to set basic permissions up to very advanced permissions using SIDs (Security Identifiers) with an <a href="https://msdn.microsoft.com/en-us/library/aa394063.aspx">access mask</a>, inheritance, and propagation strategies. First, you’ll start with querying some existing permissions.</p>
<h3 id="discovery">Discovery</h3>
<p>ACL is a custom <a href="/puppet/4.10/type.html">type</a> and <a href="/puppet/4.10/type.html#providers">provider</a>, so you can use <code>puppet resource</code> to look at existing file and folder permissions. For some types, you can use the command <code>puppet resource &lt;TYPE NAME&gt;</code> to get all instances of that type. However, there could be thousands of ACLs on a Windows system, so it’s best to specify the folder you want to review the types in. Here, check <code>c:\Users</code> to see what permissions it contains.</p>
<p>In the command prompt, type <code>puppet resource acl c:\Users</code>.</p>
<p><img src="images/windows/cli_resource_acl.png" alt="puppet resource acl c:\users output"></p>
<p>You can clean that output up just a little, as follows:</p>
<pre><code class="language-puppet">acl { 'c:\Users':
  inherit_parent_permissions =&gt; 'false',
  permissions                =&gt; [
   {identity =&gt; 'SYSTEM', rights=&gt; ['full']},
   {identity =&gt; 'Administrators', rights =&gt; ['full']},
   {identity =&gt; 'Users', rights =&gt; ['read', 'execute'], affects =&gt; 'self_only'},
   {identity =&gt; 'Users', rights =&gt; ['read', 'execute'], affects =&gt; 'children_only'},
   {identity =&gt; 'Everyone', rights =&gt; ['read', 'execute'], affects =&gt; 'self_only'},
   {identity =&gt; 'Everyone', rights =&gt; ['read', 'execute'], affects =&gt; 'children_only'}
  ],
}
</code></pre>
<p>As you can see, this particular folder does not inherit permissions from its parent folder; instead, it sets its own permissions and determines how child files and folders inherit the permissions set here.</p>
<ul>
  <li>
<code>{'identity' =&gt; 'SYSTEM', 'rights'=&gt; ['full']}</code> states that the “SYSTEM” user will have full rights to this folder, and by default all children and grandchildren files and folders (as these are the same defaults when creating permissions in Windows).</li>
  <li>
<code>{'identity' =&gt; 'Users', 'rights' =&gt; ['read', 'execute'], 'affects' =&gt; 'self_only'}</code> gives read and execute permissions to Users but only on the current directory.</li>
  <li>
<code>{'identity' =&gt; 'Everyone', 'rights' =&gt; ['read', 'execute'], 'affects' =&gt; 'children_only'}</code> gives read and execute permissions to everyone, but only on subfolders and files.</li>
</ul>
<blockquote>
  <p><strong>Note</strong>: You will likely see what appears to be the same permission for a user/group twice (both “Users” and “Everyone” above), where one affects only the folder itself and the other is about children only. They are in fact different permissions.</p>
</blockquote>
<h3 id="create-a-puppet-managed-permission">Create a Puppet managed permission</h3>
<ol>
  <li>
    <p>Run this code to create your first Puppet managed permission. Then, save it as <code>perms.pp</code>.</p>

    <pre><code class="language-puppet">file{'c:/tempperms':
 ensure =&gt; directory,
}

# By default, the acl will create an implicit relationship to any
# file resources it finds that match the location.
acl {'c:/tempperms':
 permissions =&gt; [
   {identity =&gt; 'Administrators', rights =&gt; ['full']},
   {identity =&gt; 'Users', rights =&gt; ['read','execute']}
 ],
}
</code></pre>

    <p><img src="images/windows/perms_pp_manifest.png" alt="perms.pp file"></p>
  </li>
  <li>
    <p>To validate your manifest, at the command prompt, type <code>puppet parser validate c:\path\to\perms.pp</code>. If the parser returns nothing, it means validation passed.</p>

    <p><img src="images/windows/cli_parser_validate.png" alt="puppet parser validate no issues"></p>
  </li>
  <li>
    <p>To apply the manifest, type <code>puppet apply c:\path\to\perms.pp</code>. Your output should look similar to the output below.</p>

    <pre><code class="language-powershell">Notice: Compiled catalog for win2012r2x64 in environment production in 0.12 seconds
Notice: /Stage[main]/Main/File[c:/tempperms]/ensure: created
Notice: /Stage[main]/Main/Acl[c:/tempperms]/permissions: permissions changed [
] to [
 { identity =&gt; 'BUILTIN\Administrators', rights =&gt; ["full"] },
 { identity =&gt; 'BUILTIN\Users', rights =&gt; ["read", "execute"] }
]
Notice: Applied catalog in 0.05 seconds
</code></pre>
  </li>
  <li>
    <p>Review the permissions in your Windows UI. In <strong>Windows Explorer</strong>, right-click <strong>tempperms</strong> and click <strong>Properties</strong>. Then, click the <strong>Security</strong> tab. It should appear similar to the image below.</p>

    <p><img src="images/windows/security_properties.png" alt="Security properties of c:\tempperms"></p>
  </li>
  <li>
    <p>Optional: It might appear that you have more permissions than you were hoping for here. This is because by default Windows inherits parent permissions. In this case, you might not want to do that. Adjust the <code>acl</code> resource to not inherit parent permissions by changing the <code>perms.pp</code> file to look like the below by adding <code>inherit_parent_permissions =&gt; false</code>.</p>

    <pre><code class="language-puppet">acl {'c:/tempperms':
  inherit_parent_permissions =&gt; false,
  permissions                =&gt; [
    {identity =&gt; 'Administrators', rights =&gt; ['full']},
    {identity =&gt; 'Users', rights =&gt; ['read','execute']}
  ],
}
</code></pre>
  </li>
  <li>
    <p>Save the file, and return to the command prompt to run <code>puppet parser validate c:\path\to\perms.pp</code> again.</p>
  </li>
  <li>
    <p>When it validates, run <code>puppet apply c:\path\to\perms.pp</code>.</p>

    <p>You should get output similar to the following:</p>

    <pre><code class="language-powershell">C:\&gt;puppet apply c:\puppet_code\perms.pp
Notice: Compiled catalog for win2012r2x64 in environment production in 0.08 seconds
Notice: /Stage[main]/Main/Acl[c:/tempperms]/inherit_parent_permissions: inherit_
parent_permissions changed 'true' to 'false'
Notice: Applied catalog in 0.02 seconds
</code></pre>
  </li>
  <li>
    <p>To check the permissions again, type <code>icacls c:\tempperms</code>. The command, <code>icacls</code>, is specifically for displaying and modifying ACLs.The output should be similar to the following:</p>

    <pre><code class="language-powershell">C:\&gt;icacls c:\tempperms
c:\tempperms BUILTIN\Administrators:(OI)(CI)(F)
             BUILTIN\Users:(OI)(CI)(RX)
             NT AUTHORITY\SYSTEM:(OI)(CI)(F)
             BUILTIN\Users:(CI)(AD)
             CREATOR OWNER:(OI)(CI)(IO)(F)
Successfully processed 1 files; Failed processing 0 files
</code></pre>

    <p>The output shows each permission, followed by a list of specific rights in parentheses. This output shows there are more permissions than you specified in <code>perms.pp</code>. Puppet will happily manage permissions next to unmanaged or existing permissions. In the case of removing inheritance, by default Windows copies those existing inherited permissions (or Access Control Entries, ACEs) over to the existing ACL so you have some more permissions that you might not want.</p>
  </li>
  <li>
    <p>Remove the extra permissions, so that only the permissions you’ve specified are on the folder. To do this, in your <code>perms.pp</code> set <code>purge =&gt; true</code> as follows:</p>

    <pre><code class="language-puppet">acl {'c:/tempperms':
  inherit_parent_permissions =&gt; false,
  purge                      =&gt; true,
  permissions                =&gt; [
    {identity =&gt; 'Administrators', rights =&gt; ['full']},
    {identity =&gt; 'Users', rights =&gt; ['read','execute']}
  ],
}
</code></pre>
  </li>
  <li>
    <p>Run the parser command as you have before. If it still returns no errors, then you can apply the change.</p>
  </li>
  <li>
    <p>To apply the change, type <code>puppet apply c:\path\to\perms.pp</code>. The output should be similar to below:</p>

    <pre><code class="language-powershell">C:\&gt;puppet apply c:\puppet_code\perms.pp
Notice: Compiled catalog for win2012r2x64 in environment production in 0.08 seco
nds
Notice: /Stage[main]/Main/Acl[c:/tempperms]/permissions: permissions changed [
{ identity =&gt; 'BUILTIN\Administrators', rights =&gt; ["full"] },
{ identity =&gt; 'BUILTIN\Users', rights =&gt; ["read", "execute"] },
{ identity =&gt; 'NT AUTHORITY\SYSTEM', rights =&gt; ["full"] },
{ identity =&gt; 'BUILTIN\Users', rights =&gt; ["mask_specific"], mask =&gt; '4', child_types =&gt; 'containers' },
{ identity =&gt; 'CREATOR OWNER', rights =&gt; ["full"], affects =&gt; 'children_only' }
] to [
{ identity =&gt; 'BUILTIN\Administrators', rights =&gt; ["full"] },
{ identity =&gt; 'BUILTIN\Users', rights =&gt; ["read", "execute"] }
]
Notice: Applied catalog in 0.05 seconds
</code></pre>

    <p>Puppet outputs a notice as it is removing each of the permissions.</p>
  </li>
  <li>
    <p>Take a look at the output of <code>icacls</code> again. Type <code>icacls c:\tempperms</code>.</p>

    <pre><code class="language-powershell">c:\&gt;icacls c:\tempperms
c:\tempperms BUILTIN\Administrators:(OI)(CI)(F)
            BUILTIN\Users:(OI)(CI)(RX)
Successfully processed 1 files; Failed processing 0 files
</code></pre>

    <p>Now the permissions have been set up for this directory. You can get into more advanced permission scenarios if you read the <a href="https://forge.puppetlabs.com/puppetlabs/acl#usage">usage scenarios</a> on this module’s Puppet Forge page. You can also read an in-depth <a href="https://puppetlabs.com/blog/managing-permissions-windows-access-control-lists">blog post about ACLs</a> on the Puppet blog.</p>
  </li>
</ol>
<h2 id="task-2-create-puppet-managed-registry-keys-with-registry">Task 2: Create Puppet managed registry keys with <code>registry</code>
</h2>
<p><img src="images/windows/forge_registry.png" alt="Forge puppetlabs-registry"></p>
<p>Eventually, you will likely need to use the registry to access and set highly available settings, among other things. The <a href="https://forge.puppetlabs.com/puppetlabs/registry">puppetlabs-registry</a> module, which is also a <a href="https://forge.puppetlabs.com/supported">Puppet Supported Module</a> enables you to set both registry keys and values.</p>
<h3 id="discovery-1">Discovery</h3>
<p><code>puppetlabs-registry</code> is a custom <a href="/puppet/4.10/type.html">type</a> and <a href="/puppet/4.10/type.html#providers">provider</a>, so you can use <code>puppet resource</code> to look at existing registry settings. It is also somewhat limited, like the <code>acl</code> module in that it is restricted to only what is specified. Specify <code>HKLM\Software\Microsoft\Windows</code> and see what you get.</p>
<p>Type <code>puppet resource registry_key 'HKLM\Software\Microsoft\Windows'</code>.</p>
<p><img src="images/windows/cli_resource_registry.png" alt="Output of puppet resource registry_key 'HKLM\Software\Microsoft\Windows'"></p>
<p>Not that interesting, but now take a look at a registry value.</p>
<p>Type <code>puppet resource registry_value 'HKLM\SYSTEM\CurrentControlSet\Services\BITS\DisplayName'</code>:</p>
<pre><code class="language-puppet">registry_value { 'HKLM\SYSTEM\CurrentControlSet\Services\BITS\DisplayName':
  ensure =&gt; 'present',
  data   =&gt; ['Background Intelligent Transfer Service'],
  type   =&gt; 'string',
}
</code></pre>
<p>That’s a bit more interesting than a registry key. Keys are like file paths (directories) and values are like files that can have data and be of <a href="https://forge.puppetlabs.com/puppetlabs/registry#parameters">different types</a>.</p>
<h3 id="exercise">Exercise</h3>
<ol>
  <li>
    <p>Create your first Puppet managed registry keys and values:</p>

    <pre><code class="language-puppet">registry_key { 'HKLM\Software\zTemporaryPuppet':
     ensure =&gt; present,
}

# By default the registry creates an implicit relationship to any file
# resources it finds that match the location.
registry_value {'HKLM\Software\zTemporaryPuppet\StringValue':
  ensure =&gt; 'present',
  data   =&gt; 'This is a custom value.',
  type   =&gt; 'string',
}

#forcing a 32-bit registry view; watch where this is created:
registry_key { '32:HKLM\Software\zTemporaryPuppet':
  ensure =&gt; present,
}

registry_value {'32:HKLM\Software\zTemporaryPuppet\StringValue':
  ensure =&gt; 'present',
  data   =&gt; 'This is a custom 32-bit value.',
  type   =&gt; 'expand',
}
</code></pre>
  </li>
  <li>
    <p>Save the file as <code>registry.pp</code>.</p>
  </li>
  <li>
    <p>Validate the manifest. In the command prompt, type <code>puppet parser validate c:\path\to\registry.pp</code>. If the parser returns nothing, it means validation passed.</p>
  </li>
  <li>
    <p>Now, apply the manifest by typing <code>puppet apply c:\path\to\registry.pp</code>. Your output should look similar to below.</p>

    <pre><code class="language-powershell">Notice: Compiled catalog for win2012r2x64 in environment production in 0.11 seco
nds
Notice: /Stage[main]/Main/Registry_key[HKLM\Software\zTemporaryPuppet]/ensure: c
reated
Notice: /Stage[main]/Main/Registry_value[HKLM\Software\zTemporaryPuppet\StringVa
lue]/ensure: created
Notice: /Stage[main]/Main/Registry_key[32:HKLM\Software\zTemporaryPuppet]/ensure
: created
Notice: /Stage[main]/Main/Registry_value[32:HKLM\Software\zTemporaryPuppet\Strin
gValue]/ensure: created
Notice: Applied catalog in 0.03 seconds
</code></pre>
  </li>
  <li>
    <p>Next, inspect the registry and see what you have. Press <strong>Start + R</strong>, then type <code>regedit</code> and press <strong>Enter</strong>. Once the Registry Editor opens, find your keys under <code>HKEY_LOCAL_MACHINE</code>.</p>

    <p><img src="images/windows/regedit_HKLM.png" alt="Registry Editor display of keys"></p>

    <p>Note that the 32-bit keys were created under the 32-bit section of Wow6432Node for Software.</p>
  </li>
  <li>
    <p>Apply the manifest again by typing, <code>puppet apply c:\path\to\registry.pp</code>.</p>

    <pre><code class="language-powershell">Notice: Compiled catalog for win2012r2x64 in environment production in 0.11 seconds
Notice: Applied catalog in 0.02 seconds
</code></pre>
  </li>
  <li>
    <p>Nothing changed, so there is no work for Puppet to do. In <strong>Registry Editor</strong>, change the data. Select <code>HKLM\Sofware\zTemporaryPuppet</code> and in the right box, double-click <code>StringValue</code>. Edit the value data, and click <strong>OK</strong>.</p>

    <p><img src="images/windows/regedit_edit_value.png" alt="Edit StringValue of HKLM\Sofware\zTemporaryPuppet"></p>

    <p>This time, changes have been made, so typing <code>puppet apply c:\path\to\registry.pp</code> results in a different output.</p>

    <pre><code class="language-powershell">Notice: Compiled catalog for win2012r2x64 in environment production
in 0.11 seconds
Notice: /Stage[main]/Main/Registry_value[HKLM\Software\zTemporaryPuppet\StringValue]/data:
data changed 'This is a custom value. Edited' to 'This is a custom value.'
Notice: Applied catalog in 0.03 seconds
</code></pre>

    <p>Puppet automatically corrects the configuration drift.</p>
  </li>
  <li>
    <p>Next, clean up and remove the keys and values. Make your <code>registry.pp</code> file look like the below:</p>

    <pre><code class="language-puppet">registry_key { 'HKLM\Software\zTemporaryPuppet':
  ensure =&gt; absent,
}

#forcing a 32 bit registry view, watch where this is created
registry_key { '32:HKLM\Software\zTemporaryPuppet':
  ensure =&gt; absent,
}
</code></pre>
  </li>
  <li>
    <p>Validate it with <code>puppet parser validate c:\path\to\registry.pp</code> and apply it again with <code>puppet apply c:\path\to\registry.pp</code>.</p>

    <pre><code class="language-powershell">Notice: Compiled catalog for win2012r2x64 in environment production in 0.06 seconds
Notice: /Stage[main]/Main/Registry_key[HKLM\Software\zTemporaryPuppet]/ensure: removed
Notice: /Stage[main]/Main/Registry_key[32:HKLM\Software\zTemporaryPuppet]/ensure
: removed
Notice: Applied catalog in 0.02 seconds
</code></pre>

    <p>Refresh the view in your Registry Editor. The values are gone.</p>

    <p><img src="images/windows/regedit_absent.png" alt="Removed items verification in Registry Editor"></p>
  </li>
</ol>
<h3 id="real-world-usage">Real-world usage</h3>
<p>Here’s a real world example that disables error reporting:</p>
<pre><code class="language-puppet">class puppetconf::disable_error_reporting {
  registry_value { 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting\ForceQueue':
    type =&gt; dword,
    data =&gt; '1',
  }

  registry_value { 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting\DontShowUI':
    type =&gt; dword,
    data =&gt; '1',
  }

  registry_value { 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting\DontSendAdditionalData':
    type =&gt; dword,
    data =&gt; '1',
  }

  registry_key { 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting\Consent':
    ensure       =&gt; present,
  }

  registry_value { 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting\Consent\DefaultConsent':
   type =&gt; dword,
   data =&gt; '2',
  }
}
</code></pre>
<h3 id="want-more-info-about-the-registry-module">Want more info about the registry module?</h3>
<p>Read the blog post about <a href="https://puppetlabs.com/blog/re-introducing-puppetlabs-registry-module">the re-introduction of the registry module</a>, <a href="https://puppetlabs.com/blog/puppet-works-on-windows">“Puppet works on Windows?” post</a>, view the <a href="https://puppetlabs.com/presentations/getting-started-puppet-windows-josh-cooper-puppet-labs">“Getting Started with Puppet on Windows”</a> presentation from PuppetConf 2014 by Josh Cooper, and the <a href="https://puppetlabs.com/presentations/workshop-puppet-windows-users-ethan-brown-puppet-labs">“Workshop: Puppet for Windows Users”</a> from PuppetConf 2014 by Ethan Brown. You can also see a reference and examples in the documentation of the module on the <a href="https://forge.puppetlabs.com/puppetlabs/registry/readme">Forge</a>.</p>
<h2 id="task-3-create-install-and-repackage-packages-with-chocolatey">Task 3: Create, install and repackage packages with <code>chocolatey</code>
</h2>
<p><img src="images/windows/forge_chocolatey.png" alt="Forge chocolatey-chocolatey"></p>
<p><a href="https://chocolatey.org">Chocolatey</a> is a package manager for Windows that is similar in design and execution to package managers on non-Windows systems. The <a href="https://forge.puppetlabs.com/chocolatey/chocolatey">chocolatey module</a> is a <a href="https://forge.puppetlabs.com/approved">Puppet Approved Module</a>, so it’s not elligible for Puppet Enterprise support services. The module has the capability to intall and configure Chocolatey itself, and then manage software on Windows with Chocolatey packages.</p>
<h3 id="discovery-2">Discovery</h3>
<p>Chocolatey has a custom provider for the package resource type, so you can use <code>puppet resource</code> to view existing packages.</p>
<p>Type <code>puppet resource package --param provider | more</code>. The additional provider parameter in this command outputs all types of installed packages that are detected by multiple providers.</p>
<h3 id="install-chocolatey">Install Chocolatey</h3>
<p>You are going to install Chocolatey (choco.exe) itself. You can do this following the instructions on <a href="https://chocolatey.org">Chocolatey’s home page</a>, or you can use the module to ensure Chocolatey is installed.</p>
<ol>
  <li>
    <p>Create a new manifest in the <code>chocolatey</code> module called <code>chocolatey.pp</code> with the following contents:</p>

    <pre><code class="language-puppet">include chocolatey
</code></pre>
  </li>
  <li>
    <p>Validate the manifest by typing <code>puppet parser validate c:\path\to\chocolatey.pp</code>in the command prompt. If the parser returns nothing, it means validation passed.</p>
  </li>
  <li>
    <p>Now apply the manifest with <code>puppet apply c:\path\to\chocolatey.pp</code>. Your output should look similar to the below.</p>

    <pre><code class="language-powershell">Notice: Compiled catalog for win2012r2x64 in environment production in 0.58 seconds
Notice: /Stage[main]/Chocolatey::Install/Windows_env[chocolatey_PATH_env]/ensure
: created
Notice: /Stage[main]/Chocolatey::Install/Windows_env[chocolatey_ChocolateyInstal
l_env]/ensure: created
Notice: /Stage[main]/Chocolatey::Install/Exec[install_chocolatey_official]/retur
ns: executed successfully
Notice: /Stage[main]/Chocolatey::Install/Exec[install_chocolatey_official]: Trig
gered 'refresh' from 2 events
Notice: Finished catalog run in 13.22 seconds
</code></pre>

    <p>In a production scenario, you’re likely to have a Chocolatey.nupkg file somewhere internal. In cases like that, you can use the <a href="https://forge.puppetlabs.com/chocolatey/chocolatey#use-an-internal-chocolateynupkg-for-chocolatey-installation">internal nupkg for Chocolatey installation</a>:</p>

    <pre><code class="language-puppet">class {'chocolatey':
  chocolatey_download_url =&gt; 'https://internalurl/to/chocolatey.nupkg',
  use_7zip                =&gt; false,
  log_output              =&gt; true,
}
</code></pre>
  </li>
</ol>
<h3 id="install-a-package">Install a package</h3>
<p>Normally, when installing packages you copy them locally first, make any required changes to bring everything they download to an internal location, repackage the package with the edits, and/or build your own packages to host on your internal package repository (feed). For this exercise, however, you directly install a portable Notepad++ from Chocolatey’s <a href="https://chocolatey.org/packages">community feed</a>. The <a href="https://chocolatey.org/packages/notepadplusplus.commandline">Notepad++ Commandline</a> package is portable and shouldn’t greatly effect an existing system.</p>
<ol>
  <li>
    <p>Update the manifest (<code>chocolatey.pp</code>) with the following contents:</p>

    <pre><code class="language-puppet">package {'notepadplusplus.commandline':
  ensure   =&gt; installed,
  provider =&gt; chocolatey,
}
</code></pre>
  </li>
  <li>
    <p>Validate the manifest by typing <code>puppet parser validate c:\path\to\chocolatey.pp</code>in the command prompt. If the parser returns nothing, it means validation passed.</p>
  </li>
  <li>
    <p>Now, apply the manifest with <code>puppet apply c:\path\to\chocolatey.pp</code>. Your output should look similar to below.</p>

    <pre><code>Notice: Compiled catalog for win2012r2x64 in environment production in 0.75 seconds
Notice: /Stage[main]/Main/Package[notepadplusplus.commandline]/ensure: created
Notice: Applied catalog in 15.51 seconds
</code></pre>

    <p>If you want to use this package for a production scenario, you need an internal custom feed. This is simple to set up with the <a href="https://forge.puppetlabs.com/chocolatey/chocolatey_server"><code>chocolatey_server</code> module</a>. You could also use Sonatype Nexus, Artifactory, or a CIFS share if you want to host packages with a non-Windows option, or you can use anything on Windows that exposes a NuGet OData feed (Nuget is the packaging infrastructure that Chocolatey uses). See the <a href="https://github.com/chocolatey/choco/wiki/How-To-Host-Feed">How To Host Feed</a> page of the <code>chocolatey</code> wiki for more in-depth information. You could also store packages on your Puppet master and use a file resource to verify they are in a specific local directory prior to ensuring the packages.</p>
  </li>
</ol>
<h4 id="copy-an-existing-package-and-make-it-internal-repackaging-packages">Copy an existing package and make it internal (repackaging packages)</h4>
<p>Chocolatey’s <a href="https://chocolatey.org/packages">community feed</a> has quite a few packages but they are geared towards community and use the internet for downloading from official distribution sites. However, they are attractive as they have everything necessary to install a piece of software on your machine. Through the repackaging process, by which you take a community package and bring all of the bits internal and/or embed them into the pacakge, you can completely internalize a package to host on an internal Chocolatey/NuGet repository. This gives you complete control over a package and removes the aforementioned production trust and control issues.</p>
<p>To make the existing package local, use these steps.</p>
<ol>
  <li>
    <p>Download the package from Chocolatey’s community feed by going to the <a href="https://chocolatey.org/packages/notepadplusplus.commandline">package page</a> and clicking the download link.</p>

    <p><img src="images/windows/choco_npp_download.png" alt="Download Link"></p>
  </li>
  <li>
    <p>Rename the downloaded file to end with <code>.zip</code> and unpack the file as a regular archive.</p>

    <p><img src="images/windows/choco_rename_nupkg_zip.png" alt="Rename to append .zip suffix"></p>
  </li>
  <li>
    <p>Delete the <code>_rels</code> and <code>package</code> folders and the <code>[Content_Types].xml</code> file. These are created during <code>choco pack</code> and should not be included, as they will be regenerated (and their existence leads to issues).</p>

    <p><img src="images/windows/choco_delete_pkg_files.png" alt="Remove _rels, package, and the xml file"></p>
  </li>
  <li>
    <p>Next, open <code>tools\chocolateyInstall.ps1</code>.</p>

    <pre><code class="language-powershell">Install-ChocolateyZipPackage 'notepadplusplus.commandline' 'https://notepad-plus-plus.org/repository/6.x/6.8.7/npp.6.8.7.bin.zip' "$(Split-Path -parent $MyInvocation.MyCommand.Definition)"
</code></pre>
  </li>
  <li>
    <p>Download the zip file and place it in the tools folder of the package.</p>

    <p><img src="images/windows/choco_download_zip.png" alt="Zip file embedding in package"></p>
  </li>
  <li>
    <p>Next, edit <code>chocolateyInstall.ps1</code> to point to this embedded file instead of reaching out to the internet (if the size of the file is over 50MB, you might want to put it on a file share somewhere internally for better performance).</p>

    <pre><code class="language-powershell">$toolsDir   = "$(Split-Path -parent $MyInvocation.MyCommand.Definition)"
Install-ChocolateyZipPackage 'notepadplusplus.commandline' "$toolsDir\npp.6.8.7.bin.zip" "$toolsDir"
</code></pre>

    <p>The double quotes allow for string interpolation (meaning variables get interpreted instead of taken literally).</p>
  </li>
  <li>
    <p>Next, open the <code>*.nuspec</code> file to view its contents and make any necessary changes.</p>

    <pre><code class="language-xml">&lt;?xml version="1.0"?&gt;
&lt;package xmlns="http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd"&gt;
  &lt;metadata&gt;
    &lt;id&gt;notepadplusplus.commandline&lt;/id&gt;
    &lt;version&gt;6.8.7&lt;/version&gt;
    &lt;title&gt;Notepad++ (Portable, CommandLine)&lt;/title&gt;
    &lt;authors&gt;Don Ho&lt;/authors&gt;
    &lt;owners&gt;Rob Reynolds&lt;/owners&gt;
    &lt;projectUrl&gt;https://notepad-plus-plus.org/&lt;/projectUrl&gt;
    &lt;iconUrl&gt;https://cdn.rawgit.com/ferventcoder/chocolatey-packages/02c21bebe5abb495a56747cbb9b4b5415c933fc0/icons/notepadplusplus.png&lt;/iconUrl&gt;
    &lt;requireLicenseAcceptance&gt;false&lt;/requireLicenseAcceptance&gt;
    &lt;description&gt;Notepad++ is a ... &lt;/description&gt;
    &lt;summary&gt;Notepad++ is a free (as in "free speech" and also as in "free beer") source code editor and Notepad replacement that supports several languages. &lt;/summary&gt;
    &lt;tags&gt;notepad notepadplusplus notepad-plus-plus&lt;/tags&gt;
  &lt;/metadata&gt;
&lt;/package&gt;
</code></pre>

    <p>Some organizations will change the version field to denote this is an edited internal package, for example changing <code>6.8.7</code> to <code>6.8.7.20151202</code>. For now, this is not necessary.</p>

    <p>Now you can navigate via the command line to the folder with the <code>.nuspec</code> file (from a Windows machine unless you’ve installed Mono and built choco.exe from source) and use <code>choco pack</code>. You can also be more specific and type <code>choco pack path\to\notepadplusplus.commandline.nuspec</code>. The output should be similar to below.</p>

    <pre><code>Attempting to build package from 'notepadplusplus.commandline.nuspec'.
Successfully created package 'notepadplusplus.commandline.6.8.7.nupkg'
</code></pre>

    <p>Normally you test on a system to ensure that the package you just built is good prior to pushing the package (just the *.nupkg) to your internal repository. This can be done by using <code>choco.exe</code> on a test system to install (<code>choco install notepadplusplus.commandline -source %cd%</code> - change <code>%cd%</code> to <code>$pwd</code> in PowerShell.exe) and uninstall (<code>choco uninstall notepadplusplus.commandline</code>). Another method of testing is to run the manifest pointed to a local source folder, which is what you are going to do.</p>
  </li>
  <li>
    <p>Create <code>c:\packages</code> and copy the resulting package file (<code>notepadplusplus.commandline.6.8.7.nupkg</code>) into it.</p>

    <p><img src="images/windows/choco_local_packages.png" alt="package in folder"></p>

    <p>This won’t actually install on this system since you just installed the same version from Chocolatey’s community feed. So you need to remove the existing package first. To remove it, edit your <code>chocolatey.pp</code> to set the package to absent.</p>

    <pre><code class="language-puppet">package {'notepadplusplus.commandline':
  ensure   =&gt; absent,
  provider =&gt; chocolatey,
}
</code></pre>
  </li>
  <li>
    <p>Validate the manifest with <code>puppet parser validate path\to\chocolatey.pp</code>. Apply the manifest to ensure the change <code>puppet apply c:\path\to\chocolatey.pp</code>.</p>

    <pre><code class="language-powershell">Notice: Compiled catalog for win2012r2x64 in environment production in 1.03 seconds
Notice: /Stage[main]/Main/Package[notepadplusplus.commandline]/ensure: removed
Notice: Applied catalog in 12.20 seconds
</code></pre>

    <p>You can validate that the package has been removed by checking for it in the package install location or by using <code>choco list -lo</code>.</p>

    <p><img src="images/windows/choco_list_local.png" alt="Package is uninstalled"></p>
  </li>
  <li>
    <p>Update the manifest (<code>chocolatey.pp</code>) to use the custom package.</p>

    <pre><code class="language-puppet">package {'notepadplusplus.commandline':
  ensure   =&gt; latest,
 provider =&gt; chocolatey,
 source   =&gt; 'c:\packages',
}
</code></pre>
  </li>
  <li>
    <p>Validate the manifest with the parser and then apply it again. You will see Puppet creating the new install in the output.</p>

    <pre><code>Notice: Compiled catalog for win2012r2x64 in environment production in 0.79 seconds
Notice: /Stage[main]/Main/Package[notepadplusplus.commandline]/ensure: created
Notice: Applied catalog in 14.78 seconds
</code></pre>
  </li>
  <li>
    <p>In an earlier step, you added a <code>*.zip</code> file to the package, so that you can inspect it and be sure the custom package was installed. Navigate to <code>C:\ProgramData\chocolatey\lib\notepadplusplus.commandline\tools</code> (if you have a default install location for Chocolatey) and see if you can find the <code>*.zip</code> file.</p>
  </li>
</ol>
<p><img src="images/windows/choco_list_local_installed.png" alt="Package is installed"></p>
<p>You can also validate the <code>chocolateyInstall.ps1</code> by opening and viewing it to see that it is the custom file you changed.</p>
<h4 id="create-a-package">Create a package</h4>
<p>Creating your own packages is, for some system administrators, surprisingly simple compared to other packaging standards.</p>
<p>Ensure you have at least Chocolatey CLI (choco.exe) version <code>0.9.9.11</code> or greater for this next part.</p>
<ol>
  <li>
    <p>From the command prompt, enter <code>choco new -h</code> to see a help menu of what the available options are.</p>
  </li>
  <li>
    <p>Next, use <code>choco new vagrant</code> to create a package named ‘vagrant’. The output should be similar to the following:</p>

    <pre><code>Creating a new package specification at C:\temppackages\vagrant
Generating template to a file
 at 'C:\temppackages\vagrant\vagrant.nuspec'
Generating template to a file
 at 'C:\temppackages\vagrant\tools\chocolateyinstall.ps1'
Generating template to a file
 at 'C:\temppackages\vagrant\tools\chocolateyuninstall.ps1'
Generating template to a file
 at 'C:\temppackages\vagrant\tools\ReadMe.md'
Successfully generated vagrant package specification files
 at 'C:\temppackages\vagrant'
</code></pre>

    <p>It comes with some files already templated for you to fill out (you can also create your own custom templates for later use).</p>
  </li>
  <li>
    <p>Open <code>vagrant.nuspec</code>, and edit it to look like this:</p>

    <pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;package xmlns="http://schemas.microsoft.com/packaging/2015/06/nuspec.xsd"&gt;
  &lt;metadata&gt;
    &lt;id&gt;vagrant&lt;/id&gt;
    &lt;title&gt;Vagrant (Install)&lt;/title&gt;
    &lt;version&gt;1.8.4&lt;/version&gt;
    &lt;authors&gt;HashiCorp&lt;/authors&gt;
    &lt;owners&gt;my company&lt;/owners&gt;
    &lt;description&gt;Vagrant - Development environments made easy.&lt;/description&gt;
  &lt;/metadata&gt;
  &lt;files&gt;
    &lt;file src="tools\**" target="tools" /&gt;
  &lt;/files&gt;
&lt;/package&gt;
</code></pre>

    <p>Unless you are sharing with the world, you don’t need most of what is in the nuspec template file, so only required items are included above. The important thing you should do when creating a package is match the version of the package in this nusepec file to the version of the underlying software as closely as possible. You will package the most recent version of Vagrant into this package you’ve created, so the version of the package in the nuspec file should match. In this example, Vagrant 1.8.4 is being packaged. <a href="https://github.com/chocolatey/choco/wiki/CreatePackages#versioning-recommendations">More on versioning</a>.</p>
  </li>
  <li>
    <p>Open <code>chocolateyInstall.ps1</code> and edit it to look like the following:</p>

    <pre><code class="language-powershell">$ErrorActionPreference = 'Stop';

$packageName= 'vagrant'
$toolsDir   = "$(Split-Path -parent $MyInvocation.MyCommand.Definition)"
$fileLocation = Join-Path $toolsDir 'vagrant_1.8.4.msi'

$packageArgs = @{
  packageName   = $packageName
  fileType      = 'msi'
  file         = $fileLocation

  silentArgs    = "/qn /norestart"
  validExitCodes= @(0, 3010, 1641)
}

Install-ChocolateyInstallPackage @packageArgs
</code></pre>

    <blockquote>
      <p><strong>Note</strong>: The above is <a href="https://github.com/chocolatey/choco/wiki/HelpersInstallChocolateyInstallPackage"><code>Install-ChocolateyINSTALLPackage</code></a>, not to be confused with <a href="https://github.com/chocolatey/choco/wiki/HelpersInstallChocolateyPackage"><code>Install-ChocolateyPackage</code></a>. The names are very close to each other, however the latter will also download software from a URI (URL, ftp, file) which is not necessary for this example.</p>
    </blockquote>
  </li>
  <li>
    <p>Delete the <code>ReadMe.md</code> and <code>chocolateyUninstall.ps1</code> files. <a href="https://www.vagrantup.com/downloads.html">Download Vagrant</a> and move it to the tools folder of the package.</p>

    <blockquote>
      <p><strong>Note</strong>: Normally if a package is over 100MB, it is recommended to move the software installer/archive to a share drive and point to it instead. For this example, you will just bundle it as is.</p>
    </blockquote>
  </li>
  <li>
    <p>Now pack it up by using <code>choco pack</code>. Copy the new <code>vagrant.1.8.4.nupkg</code> file to <code>c:\packages</code>.</p>
  </li>
  <li>
    <p>Open the manifest, and add the new package you just created. Your <code>chocolatey.pp</code> file should look like the below.</p>

    <pre><code class="language-puppet">package {'vagrant':
  ensure   =&gt; installed,
  provider =&gt; chocolatey,
  source   =&gt; 'c:\packages',
}
</code></pre>
  </li>
  <li>
    <p>Save the file and make sure to validate with the Puppet parser.</p>
  </li>
  <li>
    <p>Then use <code>puppet apply path\to\chocolatey.pp</code> to run the manifest.</p>

    <pre><code>Notice: Compiled catalog for win2012r2x64 in environment production in 0.70 seconds
Notice: /Stage[main]/Main/Package[vagrant]/ensure: created
Notice: Applied catalog in 31.51 seconds
</code></pre>
  </li>
  <li>
    <p>Open Control Panel, Programs and Features and take a look — Vagrant is installed!</p>
  </li>
</ol>
<p><img src="images/windows/choco_vagrant_installed.png" alt="Vagrant is installed!"></p>
<h4 id="uninstalling">Uninstalling</h4>
<p>To verify that the choco <code>autoUninstaller</code> feature is turned on, use <code>choco feature</code> to list the features and their current state. If you’re using <code>include chocolatey</code> or <code>class chocolatey</code> to ensure Chocolatey is installed, the configuration will be applied automatically (unless you have explicitly disabled it). Also, starting in Chocolatey version <code>0.9.10</code>, it is enabled by default.</p>
<ol>
  <li>
    <p>If you see <code>autoUninstaller - [Disabled]</code>, you need to enable it. To do this, in the command prompt, type <code>choco feature enable -n autoUninstaller</code> . You should see a similar success message:</p>

    <pre><code>Enabled autoUninstaller
</code></pre>
  </li>
  <li>
    <p>To remove Vagrant, edit your <code>chocolatey.pp</code> manifest to <code>ensure =&gt; absent</code>. Then save and validate the file.</p>

    <pre><code class="language-puppet">package {'vagrant':
  ensure   =&gt; absent,
  provider =&gt; chocolatey,
  source   =&gt; 'c:\packages',
}
</code></pre>
  </li>
  <li>
    <p>Next, run <code>puppet apply path\to\chocolatey.pp</code> to apply the manifest.</p>

    <pre><code>Notice: Compiled catalog for win2012r2x64 in environment production in 0.75 seconds
Notice: /Stage[main]/Main/Package[vagrant]/ensure: removed
Notice: Applied catalog in 40.85 seconds
</code></pre>

    <p><img src="images/windows/choco_vagrant_uninstalled.png" alt="Vagrant is no longer installed"></p>

    <p>And it’s no longer installed!</p>
  </li>
</ol>
<h3 id="real-world-usage-1">Real-world usage</h3>
<p>The following example ensures that Chocolatey, the Chocolatey Simple Server (an internal Chocolatey package repository), and some packages are installed. It requires the additional <a href="https://forge.puppetlabs.com/chocolatey/chocolatey_server"><code>chocolatey/chocolatey_server</code> module</a>.</p>
<p>In <code>c:\packages</code> you must have packages for <a href="https://chocolatey.org/packages/chocolatey">Chocolatey</a>, <a href="https://chocolatey.org/packages/chocolatey.server">Chocolatey.Server</a>, <a href="https://chocolatey.org/packages/roundhouse">RoundhousE</a>, <a href="https://chocolatey.org/packages/launchy">Launchy</a>, and <a href="https://chocolatey.org/packages/git">Git</a>, as well as any of their dependencies.</p>
<pre><code class="language-puppet">case $operatingsystem {
  'windows':    {
    Package {
      provider =&gt; chocolatey,
      source   =&gt; 'C:\packages',
    }
  }
}

# include chocolatey
class {'chocolatey':
  chocolatey_download_url =&gt; 'file:///C:/packages/chocolatey.0.9.9.11.nupkg',
  use_7zip                =&gt; false,
  log_output              =&gt; true,
}

# This contains the bits to install the custom server.
# include chocolatey_server
class {'chocolatey_server':
  server_package_source =&gt; 'C:/packages',
}

package {'roundhouse':
  ensure   =&gt; '0.8.5.0',
}


package {'launchy':
  ensure          =&gt; installed,
  install_options =&gt; ['-override', '-installArgs','"', '/VERYSILENT','/NORESTART','"'],
}

package {'git':
  ensure =&gt; latest,
}

</code></pre>
<h3 id="want-more-chocolatey">Want more Chocolatey?</h3>
<p>You can learn more about Chocolatey by visiting <a href="https://chocolatey.org">Chocolatey.org</a>, reading the <a href="https://github.com/chocolatey/choco/wiki">documentation on GitHub</a>, and by watching <a href="https://www.youtube.com/watch?v=NNM2H4GsWYA">“Chocolatey and Puppet - Managing Your Windows Software Since 2011”</a> from PuppetConf 2015 by Rob Reynolds. To learn specifically what the provider offers and have a reference of what is available, the module and documentation are on the <a href="https://forge.puppetlabs.com/chocolatey/chocolatey">Puppet Forge</a>.</p></article><div class="docs-feedback-inpage is-hidden" id="docs-feedback-inpage">

  <p>To send us feedback or let us know about a docs error, <a href="#">open a ticket</a> (you need a Jira account) or leave a comment.</p>

  <div class="pm-docs-feedback-form pm-margin-bottom--xl pm-margin-top--xl">

    <form name="docs-feedback-form" method="post" data-netlify="true">
      <div class="pm-margin-top--sm">
        <label class="pm-docs-feedback-form__instructions">
          Send feedback to the Docs team:
          <div class="pm-input">
            <div class="rc-input-container">
              <textarea id="comment" name="comment" class="rc-input rc-input-multiline" placeholder="What should we know about this page?"></textarea>
            </div>
          </div>
        </label>

        <label class="pm-docs-feedback-form__instructions">
          Email Address:
          <div class="pm-input">
            <div class="rc-input-container">
              <input type="email" id="email" name="email" class="rc-input" value="" placeholder="Where can we reach you to follow up?">
            </div>
          </div>
        </label>
      </div>
<!-- End pm-margin-top-/-sm -->

      <button class="pm-button pm-button--blue">Submit</button>

      <p class="pm-margin-top--sm">
        If you leave us your email, we may contact you regarding your feedback.
        For more information on how Puppet uses your personal information, see
        our
        <a href="https://puppet.com/legal/privacy-policy/" rel="noopener noreferrer" class="pm-link">privacy policy</a>.
      </p>

      <input type="hidden" name="subject" value="">

      <input type="hidden" id="url" name="url" class="rc-input" value="" placeholder="">

      <input type="hidden" id="form-name" name="form-name" class="rc-input" value="docs-feedback-form" placeholder="">

      <input type="hidden" id="comment" name="comment" class="rc-input" value="" placeholder="">

      <input type="hidden" id="email" name="email" class="rc-input" value="" placeholder="">
    </form>
  </div>
<!-- End pm-docs-feedback-form -->
</div>
<!-- End docs-feedback-inpage -->
</main>
</div></div>
<div class="pm-site-footer">
  <div class="container pm-site-footer__wrapper">
    <section>
      <div class="pm-site-footer__content">
        <div class="pm-site-footer__logo">
          <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 560.7 198.2" focusable="false">
            <path d="M99.1 99.1V53.5H64.2L45.6 34.8V0H0v45.6h34.9l18.7 18.7v24.1l-18.7 18.7H0v45.6h45.6v-34.8l18.7-18.7h34.8zM15.2 15.2h15.2v15.2H15.2zm15.2 122.2H15.2v-15.2h15.2z" fill="#ffae1a"></path>
            <path d="M149.6 198.2h-20.1V99.1h20.1v6c3.2-3.9 10.4-7.6 18.1-7.6 21.1 0 33 17.5 33 37.9s-12 37.7-33 37.7c-7.8 0-14.9-3.7-18.1-7.6v32.7zm0-51a15.23 15.23 0 0013.6 8.4c10.9 0 17.3-8.7 17.3-20.2 0-11.7-6.5-20.4-17.3-20.4a15.37 15.37 0 00-13.6 8.4zm124 24.3h-20.1v-6.6a26.24 26.24 0 01-19.4 8.3c-16.2 0-25.4-10.7-25.4-26.7V99.2h20.1v43.2c0 7.6 3.7 12.8 11.7 12.8 6.2 0 11.5-3.7 13-10v-46h20.2v72.3zm33.4 26.7h-20.1V99.1H307v6c3.2-3.9 10.4-7.6 18.1-7.6 21.1 0 33 17.5 33 37.9s-12 37.7-33 37.7c-7.8 0-14.9-3.7-18.1-7.6v32.7zm0-51a15.23 15.23 0 0013.6 8.4c10.9 0 17.3-8.7 17.3-20.2 0-11.7-6.5-20.4-17.3-20.4a15.37 15.37 0 00-13.6 8.4zm80 51h-20.1V99.1H387v6c3.2-3.9 10.4-7.6 18.1-7.6 21.1 0 33 17.5 33 37.9s-12 37.7-33 37.7c-7.8 0-14.9-3.7-18.1-7.6v32.7zm0-51a15.23 15.23 0 0013.6 8.4c10.9 0 17.3-8.7 17.3-20.2 0-11.7-6.5-20.4-17.3-20.4a15.37 15.37 0 00-13.6 8.4zm123.2.6c-2.6 15.4-13.9 25.3-32.1 25.3-21.1 0-35.1-15.4-35.1-37.7 0-21.9 14.6-37.9 34.8-37.9 21.2 0 32.9 14.7 32.9 36v6.2h-48.3c.6 10.9 6.8 17.3 15.7 17.3 6.8 0 11.8-2.9 13.4-9.1h18.7zm-47.3-20.4h28c-.2-7.6-4.7-13.6-13-13.6-7.7 0-13.2 4.7-15 13.6zm60.9-12.1h-11V99.1h11V79.5h19.9v19.6h15.9v16.2h-15.9V147c0 5.7 3.1 8.3 8.3 8.3a17.36 17.36 0 008.7-2.4v17.8c-2.8 1.5-7.6 2.3-13 2.3-14.7 0-24-7.3-24-23.3v-34.4z" fill="#fff"></path>
          </svg>
        </div>
        <div class="pm-site-footer__content-text">
          <p class="text">Puppet automates the delivery and operation of the software that powers some of the biggest brands in the world.</p>
        </div>
      </div>
    </section>
    <section>
      <div class="pm-site-footer__navs">
        <div class="pm-site-footer__legal-menu legal footer-nav"><ul class="pm-site-footer__legal-menu__items items">
<li class="item"><a href="/legal/">Legal</a></li>
<li class="item"><a href="/legal/privacy-policy/">Privacy Policy</a></li>
<li class="item"><a href="/legal/terms-of-use/">Terms of Use</a></li>
<li class="item"><a href="/security/">Security</a></li>
</ul></div>
<!-- Content generated with JS -->
        <div class="pm-site-footer__coda-menu coda footer-nav"><ul class="pm-site-footer__coda-menu__items items">
<li class="item"><a href="/sitemap/">Sitemap © 2020</a></li>
<li class="item"><a href="/">Puppet</a></li>
</ul></div>
<!-- Content generated with JS -->
      </div>
    </section>
  </div>
<!-- End pm-site-footer__wrapper -->
</div>
<!-- End pm-site-footer -->
<script src="https://puppet-docs-herrera.netlify.app/js/docs.js"></script>
</body>
</html>
